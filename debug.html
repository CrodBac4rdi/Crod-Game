<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEBUG - Cosmic Clicker 3D</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0a0a0f;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        .debug-section {
            background: #1a1a2e;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #00d4ff;
        }
        .error { border-left-color: #ff3366; }
        .success { border-left-color: #00ff88; }
        .warning { border-left-color: #ffaa00; }
        pre { background: #0a0a0f; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .test-result { margin: 5px 0; padding: 5px; border-radius: 3px; }
        .pass { background: #004400; }
        .fail { background: #440000; }
    </style>
</head>
<body>
    <h1>üîç COSMIC CLICKER 3D - DEBUG MODE</h1>
    
    <div class="debug-section">
        <h2>üìã Debug Log</h2>
        <div id="debug-log"></div>
    </div>
    
    <div class="debug-section">
        <h2>üß™ Script Loading Tests</h2>
        <div id="script-tests"></div>
    </div>
    
    <div class="debug-section">
        <h2>üéÆ Game Initialization Tests</h2>
        <div id="game-tests"></div>
    </div>
    
    <div class="debug-section">
        <h2>üåê THREE.js Tests</h2>
        <div id="three-tests"></div>
    </div>
    
    <div class="debug-section">
        <h2>üíæ Asset System Tests</h2>
        <div id="asset-tests"></div>
    </div>
    
    <div class="debug-section">
        <h2>üö® Error Log</h2>
        <div id="error-log"></div>
    </div>
    
    <!-- Load Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
    
    <!-- Debug Script -->
    <script>
        const debugLog = document.getElementById('debug-log');
        const scriptTests = document.getElementById('script-tests');
        const gameTests = document.getElementById('game-tests');
        const threeTests = document.getElementById('three-tests');
        const assetTests = document.getElementById('asset-tests');
        const errorLog = document.getElementById('error-log');
        
        let testResults = [];
        let errors = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.className = `test-result ${type}`;
            debugLog.appendChild(logEntry);
            console.log(`[DEBUG] ${message}`);
        }
        
        function testResult(name, condition, details = '') {
            const result = document.createElement('div');
            result.className = condition ? 'test-result pass' : 'test-result fail';
            result.innerHTML = `${condition ? '‚úÖ' : '‚ùå'} ${name}${details ? ': ' + details : ''}`;
            return result;
        }
        
        function addError(error) {
            errors.push(error);
            const errorEntry = document.createElement('div');
            errorEntry.className = 'test-result fail';
            errorEntry.innerHTML = `‚ùå ${error.message || error}`;
            if (error.stack) {
                errorEntry.innerHTML += `<pre>${error.stack}</pre>`;
            }
            errorLog.appendChild(errorEntry);
        }
        
        // Catch all errors
        window.addEventListener('error', (e) => {
            addError(e.error || e);
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            addError(e.reason || e);
        });
        
        // Test Three.js
        function testThreeJS() {
            log('Testing THREE.js...');
            
            threeTests.appendChild(testResult('THREE.js loaded', typeof THREE !== 'undefined'));
            
            if (typeof THREE !== 'undefined') {
                threeTests.appendChild(testResult('THREE.Scene available', typeof THREE.Scene !== 'undefined'));
                threeTests.appendChild(testResult('THREE.WebGLRenderer available', typeof THREE.WebGLRenderer !== 'undefined'));
                threeTests.appendChild(testResult('THREE.PerspectiveCamera available', typeof THREE.PerspectiveCamera !== 'undefined'));
                
                // Test WebGL
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                threeTests.appendChild(testResult('WebGL supported', gl !== null));
                
                if (gl) {
                    const renderer = gl.getParameter(gl.RENDERER);
                    const vendor = gl.getParameter(gl.VENDOR);
                    threeTests.appendChild(testResult('GPU Info', true, `${vendor} ${renderer}`));
                }
            }
        }
        
        // Test script loading
        function testScriptLoading() {
            log('Testing script loading...');
            
            const scripts = [
                'src/assets/sounds/AudioSystem.js',
                'src/assets/textures/TextureManager.js',
                'src/assets/models/ModelGenerator.js',
                'src/assets/AssetLoader.js',
                'src/assets/PerformanceOptimizer.js',
                'src/assets/AssetIntegration.js',
                'src/core/GameConfig.js',
                'src/core/EventSystem.js',
                'src/core/SaveManager.js',
                'src/game/GameState.js',
                'src/game/UpgradeManager.js',
                'src/game/AchievementManager.js',
                'src/game/ClickManager.js',
                'src/ui/UIManager.js',
                'src/ui/NotificationManager.js',
                'src/ui/FloatingTextManager.js',
                'src/utils/MathUtils.js',
                'src/utils/FormatUtils.js',
                'src/core/SceneManager.js',
                'src/core/Game.js'
            ];
            
            scripts.forEach(script => {
                fetch(script)
                    .then(response => {
                        scriptTests.appendChild(testResult(script, response.ok, response.status));
                    })
                    .catch(error => {
                        scriptTests.appendChild(testResult(script, false, error.message));
                    });
            });
        }
        
        // Test asset system
        function testAssetSystem() {
            log('Testing asset system...');
            
            setTimeout(() => {
                assetTests.appendChild(testResult('AudioSystem class', typeof AudioSystem !== 'undefined'));
                assetTests.appendChild(testResult('TextureManager class', typeof TextureManager !== 'undefined'));
                assetTests.appendChild(testResult('ModelGenerator class', typeof ModelGenerator !== 'undefined'));
                assetTests.appendChild(testResult('AssetLoader class', typeof AssetLoader !== 'undefined'));
                assetTests.appendChild(testResult('PerformanceOptimizer class', typeof PerformanceOptimizer !== 'undefined'));
                assetTests.appendChild(testResult('AssetIntegration class', typeof AssetIntegration !== 'undefined'));
                
                // Test instantiation
                try {
                    const audioSystem = new AudioSystem();
                    assetTests.appendChild(testResult('AudioSystem instantiation', true));
                } catch (error) {
                    assetTests.appendChild(testResult('AudioSystem instantiation', false, error.message));
                }
                
                try {
                    const textureManager = new TextureManager();
                    assetTests.appendChild(testResult('TextureManager instantiation', true));
                } catch (error) {
                    assetTests.appendChild(testResult('TextureManager instantiation', false, error.message));
                }
                
                try {
                    const performanceOptimizer = new PerformanceOptimizer();
                    assetTests.appendChild(testResult('PerformanceOptimizer instantiation', true));
                } catch (error) {
                    assetTests.appendChild(testResult('PerformanceOptimizer instantiation', false, error.message));
                }
            }, 2000);
        }
        
        // Test game system
        function testGameSystem() {
            log('Testing game system...');
            
            setTimeout(() => {
                gameTests.appendChild(testResult('GameConfig available', typeof GameConfig !== 'undefined'));
                gameTests.appendChild(testResult('EventSystem class', typeof EventSystem !== 'undefined'));
                gameTests.appendChild(testResult('GameState class', typeof GameState !== 'undefined'));
                gameTests.appendChild(testResult('CosmicClicker class', typeof CosmicClicker !== 'undefined'));
                gameTests.appendChild(testResult('SceneManager class', typeof SceneManager !== 'undefined'));
                
                // Test GameConfig
                if (typeof GameConfig !== 'undefined') {
                    gameTests.appendChild(testResult('GameConfig.GENERATORS', Array.isArray(GameConfig.GENERATORS)));
                    gameTests.appendChild(testResult('GameConfig.ACHIEVEMENTS', Array.isArray(GameConfig.ACHIEVEMENTS)));
                }
                
                // Test instantiation
                try {
                    const eventSystem = new EventSystem();
                    gameTests.appendChild(testResult('EventSystem instantiation', true));
                } catch (error) {
                    gameTests.appendChild(testResult('EventSystem instantiation', false, error.message));
                }
                
                try {
                    const gameState = new GameState(new EventSystem());
                    gameTests.appendChild(testResult('GameState instantiation', true));
                } catch (error) {
                    gameTests.appendChild(testResult('GameState instantiation', false, error.message));
                }
            }, 3000);
        }
        
        // Start tests
        log('üöÄ Starting debug tests...');
        
        setTimeout(() => {
            testThreeJS();
            testScriptLoading();
            testAssetSystem();
            testGameSystem();
        }, 1000);
        
        // Try to load and test actual scripts
        log('Loading scripts for testing...');
        
        const loadScript = (src) => {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        };
        
        // Load scripts in order
        async function loadAllScripts() {
            const scripts = [
                'src/assets/sounds/AudioSystem.js',
                'src/assets/textures/TextureManager.js',
                'src/assets/models/ModelGenerator.js',
                'src/assets/AssetLoader.js',
                'src/assets/PerformanceOptimizer.js',
                'src/assets/AssetIntegration.js',
                'src/core/GameConfig.js',
                'src/core/EventSystem.js',
                'src/core/SaveManager.js',
                'src/game/GameState.js',
                'src/game/UpgradeManager.js',
                'src/game/AchievementManager.js',
                'src/game/ClickManager.js',
                'src/ui/UIManager.js',
                'src/ui/NotificationManager.js',
                'src/ui/FloatingTextManager.js',
                'src/utils/MathUtils.js',
                'src/utils/FormatUtils.js',
                'src/core/SceneManager.js',
                'src/core/Game.js'
            ];
            
            for (const script of scripts) {
                try {
                    await loadScript(script);
                    log(`‚úÖ Loaded: ${script}`, 'pass');
                } catch (error) {
                    log(`‚ùå Failed to load: ${script} - ${error.message}`, 'fail');
                    addError(error);
                }
            }
            
            log('All scripts loaded, running final tests...');
            
            // Final test: try to create the game
            setTimeout(() => {
                try {
                    log('Creating AssetIntegration...');
                    window.AssetIntegration = new AssetIntegration();
                    log('‚úÖ AssetIntegration created successfully', 'pass');
                    
                    log('Creating CosmicClicker...');
                    const game = new CosmicClicker();
                    log('‚úÖ CosmicClicker created successfully', 'pass');
                    
                    log('üéâ ALL TESTS PASSED! Game should work now.', 'pass');
                    
                } catch (error) {
                    log(`‚ùå Game creation failed: ${error.message}`, 'fail');
                    addError(error);
                }
            }, 1000);
        }
        
        loadAllScripts();
    </script>
</body>
</html>